# Telegram Bot ‚Äî –ß–µ—Ä–Ω—ã–π —Å–ø–∏—Å–æ–∫ –∞—Ä–µ–Ω–¥—ã —ç–ª–µ–∫—Ç—Ä–æ—Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∞

Telegram –±–æ—Ç –Ω–∞ –±–∞–∑–µ `async telebot` –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —á–µ—Ä–Ω—ã–º —Å–ø–∏—Å–∫–æ–º –∞—Ä–µ–Ω–¥–∞—Ç–æ—Ä–æ–≤ —ç–ª–µ–∫—Ç—Ä–æ—Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∞ —Å –∞–Ω–æ–Ω–∏–º–∏–∑–∞—Ü–∏–µ–π –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö (—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ 152-–§–ó).

## –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- üîê **–†–æ–ª–µ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞ –¥–æ—Å—Ç—É–ø–∞** (SUPER_ADMIN, ADMIN, MANAGER)
- üìã **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —á–µ—Ä–Ω—ã–º —Å–ø–∏—Å–∫–æ–º** —Å –ø–æ—à–∞–≥–æ–≤—ã–º —Å–±–æ—Ä–æ–º –¥–∞–Ω–Ω—ã—Ö
- üîí **–ê–Ω–æ–Ω–∏–º–∏–∑–∞—Ü–∏—è –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö** —á–µ—Ä–µ–∑ —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Å —Å–æ–ª—å—é –∏ –ø–µ—Ä—Ü–µ–º
- üîç **–ö—Ä–æ—Å—Å-–æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–æ–Ω–Ω—ã–π –ø–æ–∏—Å–∫** –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- üìä **–ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π** –≤—Å–µ—Ö –∑–∞–ø–∏—Å–µ–π —á–µ—Ä–Ω–æ–≥–æ —Å–ø–∏—Å–∫–∞

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
back_lict_rent/
‚îú‚îÄ‚îÄ main.py                          # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
‚îú‚îÄ‚îÄ requirements.txt                 # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –ø—Ä–æ–µ–∫—Ç–∞
‚îú‚îÄ‚îÄ env.example                      # –ü—Ä–∏–º–µ—Ä –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
‚îú‚îÄ‚îÄ DockerFile                       # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Docker
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ config.py                    # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ db/                          # –ú–æ–¥—É–ª—å —Ä–∞–±–æ—Ç—ã —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ connection.py            # –ú–µ–Ω–µ–¥–∂–µ—Ä –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π –∫ –ë–î
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ table/                   # –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Ç–∞–±–ª–∏—Ü
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ base.py              # –û–±—â–∏–µ SQL-—Ñ—É–Ω–∫—Ü–∏–∏
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ admins.py            # –¢–∞–±–ª–∏—Ü–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ organizations.py     # –¢–∞–±–ª–∏—Ü–∞ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–π
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ admin_organizations.py # –°–≤—è–∑—å –∞–¥–º–∏–Ω–æ–≤ –∏ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–π
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ blacklist_persons.py # –û–±–µ–∑–ª–∏—á–µ–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –ß–°
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ blacklist_records.py # –ó–∞–ø–∏—Å–∏ —á–µ—Ä–Ω–æ–≥–æ —Å–ø–∏—Å–∫–∞
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ blacklist_history.py # –ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π –ß–°
‚îÇ   ‚îî‚îÄ‚îÄ bot/                         # –ú–æ–¥—É–ª—å Telegram –±–æ—Ç–∞
‚îÇ       ‚îú‚îÄ‚îÄ application/             # –°–ª–æ–π –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ context.py           # DI-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ decorators.py        # –î–µ–∫–æ—Ä–∞—Ç–æ—Ä—ã (–ø—Ä–æ–≤–µ—Ä–∫–∞ —Ä–æ–ª–µ–π)
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ register_handlers.py # –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ handlers/            # –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–æ–º–∞–Ω–¥
‚îÇ       ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ start/           # /start
‚îÇ       ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ id/              # /id
‚îÇ       ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ blacklist/       # –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤ –ß–°
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ keyboard/            # –ö–ª–∞–≤–∏–∞—Ç—É—Ä—ã –º–µ–Ω—é
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ states/              # FSM-—Å–æ—Å—Ç–æ—è–Ω–∏—è
‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ storage/             # –•—Ä–∞–Ω–∏–ª–∏—â–µ —Å–æ—Å—Ç–æ—è–Ω–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
‚îÇ       ‚îú‚îÄ‚îÄ domain/                  # –î–æ–º–µ–Ω–Ω—ã–π —Å–ª–æ–π (—Å—É—â–Ω–æ—Å—Ç–∏)
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ role.py              # Enum —Ä–æ–ª–µ–π
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ admin.py             # –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ organization.py      # –û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ blacklist_person.py  # –û–±–µ–∑–ª–∏—á–µ–Ω–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ blacklist_record.py  # –ó–∞–ø–∏—Å—å –ß–°
‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ blacklist_history.py # –ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π
‚îÇ       ‚îú‚îÄ‚îÄ repo/                    # –°–ª–æ–π —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–≤
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ admin_repository.py
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ organization_repository.py
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ blacklist_person_repository.py
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ blacklist_record_repository.py
‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ blacklist_history_repository.py
‚îÇ       ‚îú‚îÄ‚îÄ service/                 # –°–ª–æ–π —Å–µ—Ä–≤–∏—Å–æ–≤ (–±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞)
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ access_service.py    # –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –ø–æ —Ä–æ–ª—è–º
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ hash_service.py      # –•–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ blacklist_service.py # –õ–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã —Å –ß–°
‚îÇ       ‚îî‚îÄ‚îÄ utils/                   # –£—Ç–∏–ª–∏—Ç—ã
‚îÇ           ‚îî‚îÄ‚îÄ validators.py        # –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
‚îî‚îÄ‚îÄ test/                            # –¢–µ—Å—Ç—ã
    ‚îú‚îÄ‚îÄ api/
    ‚îî‚îÄ‚îÄ bot/
```

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –∑–∞–ø—É—Å–∫

### 1. –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

```bash
git clone <repository-url>
cd back_lict_rent
python -m venv venv
source venv/bin/activate  # Linux/macOS
# –∏–ª–∏
venv\Scripts\activate     # Windows
pip install -r requirements.txt
```

### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è

–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `.env` –Ω–∞ –æ—Å–Ω–æ–≤–µ `env.example`:

```bash
cp env.example .env
```

–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è:

```env
# Telegram Bot Configuration
BOT_TOKEN=your_telegram_bot_token_here
ADMIN_IDS=123456789,987654321

# Database Configuration
DB_HOST=localhost
DB_PORT=5432
DB_USER=postgres
DB_PASSWORD=your_password_here
DB_NAME=lict_rent

# Application Configuration
DEBUG=False
LOG_LEVEL=INFO

# Security Configuration (–í–ê–ñ–ù–û!)
HASH_PEPPER=your_secret_pepper_minimum_32_characters_here
```

**–ì–µ–Ω–µ—Ä–∞—Ü–∏—è HASH_PEPPER:**
```bash
python -c "import secrets; print(secrets.token_urlsafe(32))"
```

### 3. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

–°–æ–∑–¥–∞–π—Ç–µ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö PostgreSQL:

```sql
CREATE DATABASE lict_rent;
```

–¢–∞–±–ª–∏—Ü—ã —Å–æ–∑–¥–∞—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ –±–æ—Ç–∞.

### 4. –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞

```bash
python main.py
```

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

–ü—Ä–æ–µ–∫—Ç —Å–ª–µ–¥—É–µ—Ç –ø—Ä–∏–Ω—Ü–∏–ø–∞–º **Clean Architecture**:

| –°–ª–æ–π | –ü—É—Ç—å | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|------|----------|
| **Application** | `src/bot/application/` | –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏, FSM, –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã |
| **Domain** | `src/bot/domain/` | –î–æ–º–µ–Ω–Ω—ã–µ —Å—É—â–Ω–æ—Å—Ç–∏, Enum-—ã |
| **Repository** | `src/bot/repo/` | –î–æ—Å—Ç—É–ø –∫ –¥–∞–Ω–Ω—ã–º (CRUD) |
| **Service** | `src/bot/service/` | –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ |

## –†–æ–ª–µ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞

| –†–æ–ª—å | –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç | –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ |
|------|-----------|-------------|
| `SUPER_ADMIN` | 3 | –ü–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫–æ –≤—Å–µ–º —Ñ—É–Ω–∫—Ü–∏—è–º |
| `ADMIN` | 2 | –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —á–µ—Ä–Ω—ã–º —Å–ø–∏—Å–∫–æ–º |
| `MANAGER` | 1 | –ü—Ä–æ—Å–º–æ—Ç—Ä –∏ –±–∞–∑–æ–≤—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ |

–†–æ–ª–∏ –Ω–∞—Å–ª–µ–¥—É—é—Ç—Å—è: ADMIN –∏–º–µ–µ—Ç –¥–æ—Å—Ç—É–ø –∫–æ –≤—Å–µ–º —Ñ—É–Ω–∫—Ü–∏—è–º MANAGER.

## –ê–ª–≥–æ—Ä–∏—Ç–º –∞–Ω–æ–Ω–∏–º–∏–∑–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö

–ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –Ω–µ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ –æ—Ç–∫—Ä—ã—Ç–æ–º –≤–∏–¥–µ. –í–º–µ—Å—Ç–æ —ç—Ç–æ–≥–æ:

1. **–•–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ**: SHA-256 —Å —Å–æ–ª—å—é –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ + –≥–ª–æ–±–∞–ª—å–Ω—ã–º –ø–µ—Ä—Ü–µ–º
2. **–•—Ä–∞–Ω–∏–º—ã–µ —Ö–µ—à–∏**:
   - –§–ò–û (–ø–æ–ª–Ω–æ–µ)
   - –§–∞–º–∏–ª–∏—è (–¥–ª—è —á–∞—Å—Ç–∏—á–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞)
   - –î–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è
   - –ü–∞—Å–ø–æ—Ä—Ç (—Å–µ—Ä–∏—è + –Ω–æ–º–µ—Ä)
   - –ö–æ–¥ –ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è
   - –¢–µ–ª–µ—Ñ–æ–Ω (–ø–æ–ª–Ω—ã–π + –ø–æ—Å–ª–µ–¥–Ω–∏–µ 10 —Ü–∏—Ñ—Ä)

### –ê–ª–≥–æ—Ä–∏—Ç–º –∫—Ä–æ—Å—Å-–æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–æ–Ω–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞

–ü—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –ß–° –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –µ–≥–æ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ –≤ –¥—Ä—É–≥–∏—Ö –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è—Ö:

```
1. –ò—â–µ–º –ø–æ –ø–∞—Å–ø–æ—Ä—Ç—É ‚Üí –ù–ï –Ω–∞–π–¥–µ–Ω ‚Üí –Ω–æ–≤—ã–π —á–µ–ª–æ–≤–µ–∫
2. –ü–∞—Å–ø–æ—Ä—Ç –Ω–∞–π–¥–µ–Ω ‚Üí –ø—Ä–æ–≤–µ—Ä—è–µ–º –∫–æ–¥ –ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è
   ‚îî‚îÄ –°–æ–≤–ø–∞–ª ‚Üí —ç—Ç–æ —Ç–æ—Ç –∂–µ —á–µ–ª–æ–≤–µ–∫
   ‚îî‚îÄ –ù–ï —Å–æ–≤–ø–∞–ª ‚Üí –ø—Ä–æ–≤–µ—Ä—è–µ–º –¥–∞—Ç—É —Ä–æ–∂–¥–µ–Ω–∏—è
      ‚îî‚îÄ –°–æ–≤–ø–∞–ª–∞ ‚Üí —ç—Ç–æ —Ç–æ—Ç –∂–µ —á–µ–ª–æ–≤–µ–∫
      ‚îî‚îÄ –ù–ï —Å–æ–≤–ø–∞–ª–∞ ‚Üí –Ω–æ–≤—ã–π —á–µ–ª–æ–≤–µ–∫
```

## –ö–æ–º–∞–Ω–¥—ã –±–æ—Ç–∞

| –ö–æ–º–∞–Ω–¥–∞ | –î–æ—Å—Ç—É–ø | –û–ø–∏—Å–∞–Ω–∏–µ |
|---------|--------|----------|
| `/start` | MANAGER+ | –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é |
| `/id` | –í—Å–µ | –ü–æ–∫–∞–∑–∞—Ç—å —Å–≤–æ–π Telegram ID |
| üö´ –î–æ–±–∞–≤–∏—Ç—å –≤ –ß–° | ADMIN+ | –ü–æ—à–∞–≥–æ–≤–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤ —á–µ—Ä–Ω—ã–π —Å–ø–∏—Å–æ–∫ |
| üîç –ü—Ä–æ–≤–µ—Ä–∏—Ç—å | MANAGER+ | –ü–æ–∏—Å–∫ –≤ —á–µ—Ä–Ω–æ–º —Å–ø–∏—Å–∫–µ |

## –ü—Ä–æ—Ü–µ—Å—Å –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –≤ –ß–°

1. **–§–ò–û** ‚Äî –§–∞–º–∏–ª–∏—è –ò–º—è –û—Ç—á–µ—Å—Ç–≤–æ
2. **–î–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è** ‚Äî –î–î.–ú–ú.–ì–ì–ì–ì
3. **–ü–∞—Å–ø–æ—Ä—Ç** ‚Äî —Å–µ—Ä–∏—è –∏ –Ω–æ–º–µ—Ä (10 —Ü–∏—Ñ—Ä)
4. **–ö–æ–¥ –ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è** ‚Äî 6 —Ü–∏—Ñ—Ä
5. **–¢–µ–ª–µ—Ñ–æ–Ω** ‚Äî –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ
6. **–ü—Ä–∏—á–∏–Ω–∞** ‚Äî –≤—ã–±–æ—Ä –∏–∑ —Å–ø–∏—Å–∫–∞ –∏–ª–∏ —Ä—É—á–Ω–æ–π –≤–≤–æ–¥
7. **–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π** ‚Äî –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ

–í—Å–µ —Å–æ–æ–±—â–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É–¥–∞–ª—è—é—Ç—Å—è.

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- ‚úÖ –°–µ–∫—Ä–µ—Ç—ã –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è (–Ω–µ –≤ –∫–æ–¥–µ)
- ‚úÖ Parameterized queries —á–µ—Ä–µ–∑ asyncpg
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Å–µ—Ö –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ –•–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö (152-–§–ó)
- ‚úÖ –ê–≤—Ç–æ—É–¥–∞–ª–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π —Å –ü–î–Ω
- ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –±–µ–∑ —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ –£–Ω–∏–∫–∞–ª—å–Ω–∞—è —Å–æ–ª—å –¥–ª—è –∫–∞–∂–¥–æ–π –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏

## –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

### –¢–∞–±–ª–∏—Ü—ã

| –¢–∞–±–ª–∏—Ü–∞ | –û–ø–∏—Å–∞–Ω–∏–µ |
|---------|----------|
| `admins` | –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã —Å —Ä–æ–ª—è–º–∏ |
| `organizations` | –û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ —Å —É–Ω–∏–∫–∞–ª—å–Ω–æ–π —Å–æ–ª—å—é |
| `admin_organizations` | –°–≤—è–∑—å M:N –∞–¥–º–∏–Ω–æ–≤ –∏ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–π |
| `blacklist_persons` | –û–±–µ–∑–ª–∏—á–µ–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ (—Ö–µ—à–∏) |
| `blacklist_records` | –ó–∞–ø–∏—Å–∏ —á–µ—Ä–Ω–æ–≥–æ —Å–ø–∏—Å–∫–∞ |
| `blacklist_history` | –ò—Å—Ç–æ—Ä–∏—è –≤—Å–µ—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π |

### ER-–¥–∏–∞–≥—Ä–∞–º–º–∞ (—É–ø—Ä–æ—â—ë–Ω–Ω–∞—è)

```
admins ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ< admin_organizations >‚îÄ‚îÄ‚î¨‚îÄ‚îÄ organizations
         ‚îÇ                           ‚îÇ
         ‚îÇ                           ‚îú‚îÄ‚îÄ blacklist_persons
         ‚îÇ                           ‚îÇ         ‚îÇ
         ‚îî‚îÄ‚îÄ blacklist_records ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                    ‚îÇ
                    ‚îî‚îÄ‚îÄ< blacklist_history
```

## –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞

1. –°–æ–∑–¥–∞–π—Ç–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –≤ `src/bot/application/handlers/`
2. –†–µ–∞–ª–∏–∑—É–π—Ç–µ handler-—Ñ—É–Ω–∫—Ü–∏—é
3. –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ –≤ `register_handlers.py`

```python
# src/bot/application/handlers/mycommand/mycommand.py
async def my_handler(message: Message, bot: AsyncTeleBot) -> None:
    await bot.reply_to(message, "–û—Ç–≤–µ—Ç")

# –í register_handlers.py:
bot.message_handler(commands=["mycommand"], pass_bot=True)(
    require_role(Role.MANAGER, access_service)(my_handler)
)
```

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞

1. –°–æ–∑–¥–∞–π—Ç–µ –∫–ª–∞—Å—Å –≤ `src/bot/service/`
2. –î–æ–±–∞–≤—å—Ç–µ –≤ `BotContext` –∫–∞–∫ lazy property
3. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —á–µ—Ä–µ–∑ `context.my_service`

## –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

- `pyTelegramBotAPI` ‚Äî –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π Telegram Bot API
- `asyncpg` ‚Äî –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –¥—Ä–∞–π–≤–µ—Ä PostgreSQL
- `python-dotenv` ‚Äî –ó–∞–≥—Ä—É–∑–∫–∞ .env
- `python-dateutil` ‚Äî –†–∞–±–æ—Ç–∞ —Å –¥–∞—Ç–∞–º–∏
- `aiohttp` ‚Äî HTTP-–∫–ª–∏–µ–Ω—Ç –¥–ª—è Telegram

## –õ–∏—Ü–µ–Ω–∑–∏—è

MIT
